
<!DOCTYPE html>
<html lang="en" ng-app="angbt">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>angularBootstrap</title>

    <link href="./css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom styles for this template -->
    <link href="./css/carousel.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
<body>
		<ui-view></ui-view>
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./js/angular.js"></script>
    <script src="./js/angular-ui-router.js"></script>
    <script>
    	var angbtApp=angular.module('angbt',['ui.router'])
    	angbtApp.config(function($stateProvider,$urlRouterProvider,$urlMatcherFactoryProvider){
				$urlRouterProvider.otherwise('/navbar/home');//找不到，返回默认页
				$urlMatcherFactoryProvider.caseInsensitive(true);//忽略大小写
				$stateProvider
				.state('navbar',{
					url:'/navbar',
					templateUrl:'./template/navbar.html',
					controller:'navbarController'
				})
				.state('navbar.home',{
					url:'/home',
					templateUrl:'./template/home.html',
					controller:'homeController'
				})
				.state('navbar.foodList',{
					url:'/foodList/:id/:page',
					templateUrl:'./template/foodList.html',
					controller:'foodListController'
				})
				.state('navbar.foodDetail',{
					url:'/foodDetail/:id',
					templateUrl:'./template/foodDetail.html',
					controller:'foodDetailController'
				})
							
			});
			angbtApp.controller('foodDetailController',['$scope','$http','$stateParams',function($scope,$http,$stateParams){
					$http({
						url:'http://1.1769301150.applinzi.com/test/foodDetail.php',
						params:{
							id:$stateParams.id
						}
					}).then(function(res){
							var result=res.data;
							var pos=result.indexOf('<script type="text/javascript">');
							var getResult=result.substring(0,pos);
							var resdata=JSON.parse(getResult);
							$scope.foodDeatil=resdata;
							console.log(resdata)
					})
			}])
			angbtApp.controller('navbarController',['$scope','$http',function($scope,$http){
    			$http({
    				url:'http://1.1769301150.applinzi.com/test/zs.php'
    			}).then(function(res){
	    				var result=res.data;
							var pos=result.indexOf('<script type="text/javascript">');
							var getResult=result.substring(0,pos);
							var resdata=JSON.parse(getResult);
							//console.log(resdata.tngou);
							$scope.foodClassList = resdata.tngou;					
    			})
    	}]);
    	angbtApp.controller('homeController',['$scope','$http',function($scope,$http){
    			$scope.welcome='欢迎来到旅游区！';
    			return $http({
    				url:'http://1.1769301150.applinzi.com/test/demo.php'
    			}).then(function(res){
	    				var result=res.data;
							var pos=result.indexOf('<script type="text/javascript">');
							var getResult=result.substring(0,pos);
							var resdata=JSON.parse(getResult);
//							console.log(resdata.data.books);
							$scope.homeList = resdata.data.books;					
    			})
    	}]);
    	angbtApp.controller('foodListController',['$scope','$stateParams','$http',function($scope,$stateParams,$http){
	    		$http({
	    			url:'http://1.1769301150.applinzi.com/test/list.php',
	    			params:{
	    				id:$stateParams.id,
	    				page:$stateParams.page
	    			}
	    		}).then(function(res){
	    			var result=res.data;
						var pos=result.indexOf('<script type="text/javascript">');
						var getResult=result.substring(0,pos);
						var resdata=JSON.parse(getResult);
	    			$scope.foodList=resdata.tngou;
//	    			console.log(resdata);
	    			var pageCount=[];
	    			var rows=9;
	    			for(var i=0;i<Math.ceil(resdata.total/rows);i++){
	    				pageCount.push(i);
	    			}
	    			$scope.pageCount=pageCount;
	    			$scope.id=$stateParams.id;
	    			
	    		})
    	}]);
    		
    </script>
  </body>
</html>
